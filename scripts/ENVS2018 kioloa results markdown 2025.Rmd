---
title: "ENVS2018 Environmental Science Field School: Kioloa analyses"
author: "Shoshana Rapley, Saul Cunningham"
date: "19 September 2025"
output:
  html_document:
    toc: true
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: true
    theme: cerulean
    highlight: pygments
    code_folding: hide
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = file.path(dirname(inputFile), '../results/ENVS2018 Kioloa Report Results 2025.html')) })
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
knitr::opts_knit$set(root.dir = here::here())
```

# Background

For your report, we would like you to discuss the patterns of biodiversity you observed. In particular, you should examine the composition and structure of different plant communities at Kioloa, whether animal (especialy bird) communities also differ, and consider how these patterns relate to the underlying soils and geology.

We are excited to share the whole-class survey results with you all, because there are some really interesting patterns here. Keep in mind when writing the reports that we want you to use this data summary as source material. We are not expecting that you do further, more complex analyses (but you can if you really want). You can focus on the summary data that we have provided. You may also use the figures/graphs from this markdown in your report (no citation required).

Also you are not required to report on every piece of data. Given that we have more than 100 species in the list and 14 habitat measures, this would dilute the message of the report. Keep your focus on the data that show patterns of interest. Try to pick a narrative from these data that you find interesting and that you can explain within the constraints of the word count. 

# Markdown

This document is called a 'markdown'. It's a way to share code, annotations and results all in one place. 

If you are interested in the code you can unfold the chunks by clicking the 'Show' icon. There is also an option on the top right of the document called 'Code' that allows you to show or hide all code chunks. Notes in the code itself that start with a hash explain what the next line of code achieves.  

```{r}
# Install and load required packages
pacman::p_load(dplyr, gdata, ggplot2, ggrepel, gt, gtExtras, janitor, lme4, lubridate, 
               rstudioapi, readxl, sjmisc, tidyr, tidyverse, vegan, viridis)
```

# Vegetation communities

## Floral composition

Let's start by looking at a matrix of the floral composition. 

We have used the results of your survey of abundant plant species in the sites to describe plant communities.

The idea here is to recognise that there are sets of sites that have some important similarities in terms of the plant species in them, especially those more abundant species that help to define the vegetation structure. This is not exactly the same as the plant community classification that you might find on other sources, such as on “Trees Near Me” (https://treesnearme.app/) because we have based it on our own local survey of sites. That’s is OK, because plant communities are ultimately a human construct that we use for descriptive purposes – they don’t have a strict definition that would make any one classification “correct”.

Each row is a plant species and each column is a site. In the cells we have marked O (overstory) M (midstory) and G (ground layer) to show where the species occurs.

To read the table, look at the vertical blocks of colour that highlight the different plant communities, and the darker colours that highlight the plants that characterise each community. There are six plant communities (and one transitional zone) which are described after the table.

The ordering from top to bottom is arranged to make the associations clearer (to arrange the blocks) so it is not perfectly arranged into overstory, midstory, and understory. 

The functional group in the first column helps you see what kind of plant it is. Also note the horizontal coloured band that highlights the presence of Acacia in the midstory of CBF, SGBF and RFG.

The tally shows how many sites each species was found in.

When you report on the analysis remember to look at where these sites occur in relation to each other and how this relates to the underlying soil, the topography and the distance from the ocean. Also examine how the species composition relates to the structural characteristics that are described by the biometric survey.

```{r}
# read in the data - skip the top row, will create this with spanner headers
comp_data <- read_excel("data/ENVS2018 kioloa flora composition 2025.xlsx", skip = 1) %>%
  # and drop notes column because too compact in table
  select(-27)

# create a pretty table using the package 'gt'
comp_table <- gt(comp_data) %>%
  tab_options(data_row.padding = px(1)) %>%
  # add header
  tab_header(title = "Floral composition", 
             subtitle = "ENVS2018 Student data Kioloa 2025") %>%
  # replace NAs with blanks
  tab_style(cell_text(style = "italic"),locations = cells_body(columns = 2)) %>%
  sub_missing(missing_text = " ") %>%
   # add column colours for community type (using a 7 colour viridis scale with a = 0.2 transparency)
  tab_style(style = list(cell_fill(color = "#44015433")),
    locations = cells_body(columns = 3:6)) %>%
  tab_style(style = list(cell_fill(color = "#443A8333")),
    locations = cells_body(columns = 7:9)) %>%  
  tab_style(style = list(cell_fill(color = "#31688E33")),
    locations = cells_body(columns = 10:12)) %>%
  tab_style(style = list(cell_fill(color = "#21908C33")),
    locations = cells_body(columns = 13)) %>%
  tab_style(style = list(cell_fill(color = "#35B77933")),
    locations = cells_body(columns = 14:16)) %>%
  tab_style(style = list(cell_fill(color = "#8FD74433")),
    locations = cells_body(columns = 17:19)) %>%
  tab_style(style = list(cell_fill(color = "#FDE72533")),
    locations = cells_body(columns = 20:25)) %>%
  # add row/column colours for clusters (using 7 colour viridis scale - transparency for less important groups)
  tab_style(style = list(cell_fill(color = "#440154FF"), cell_text(color = "white")),
    locations = cells_body(columns = 3:6, rows = c(42:51))) %>%
  tab_style(style = list(cell_fill(color = "#443A83FF"), cell_text(color = "white")),
    locations = cells_body(columns = 7:9, rows = c(1:10))) %>%  
  tab_style(style = list(cell_fill(color = "#31688EFF"), cell_text(color = "white")),
    locations = cells_body(columns = 10:12, rows = c(11:16))) %>%
  tab_style(style = list(cell_fill(color = "#21908CFF"), cell_text(color = "white")),
    locations = cells_body(columns = 13, rows = c(12:18))) %>%
  tab_style(style = list(cell_fill(color = "#35B779FF"), cell_text(color = "white")),
    locations = cells_body(columns = 14:16, rows = c(16:17))) %>%
  tab_style(style = list(cell_fill(color = "#8FD744FF"), cell_text(color = "white")),
    locations = cells_body(columns = 17:19, rows = c(16:17))) %>%
  tab_style(style = list(cell_fill(color = "#FDE725FF"), cell_text(color = "black")),
    locations = cells_body(columns = 20:25, rows = c(18:28))) %>%
  # and secondary clusters with a = 0.6 transparency (starting from 3rd colour)
  tab_style(style = list(cell_fill(color = "#31688E99"), cell_text(color = "white")),
    locations = cells_body(columns = 10:12, rows = c(58:63))) %>%
  tab_style(style = list(cell_fill(color = "#21908C99"), cell_text(color = "white")),
    locations = cells_body(columns = 13, rows = c(58:63))) %>%
  tab_style(style = list(cell_fill(color = "#35B77999"), cell_text(color = "white")),
    locations = cells_body(columns = 14:16, rows = c(19:23, 30:32, 58:63))) %>%
  tab_style(style = list(cell_fill(color = "#8FD74499"), cell_text(color = "white")),
    locations = cells_body(columns = 17:19, rows = c(19:23, 30:32, 58:63, 37:41))) %>%
  tab_style(style = list(cell_fill(color = "#FDE72599"), cell_text(color = "black")),
    locations = cells_body(columns = 20:25, rows = c(16:17, 29:36, 58:63))) %>%
  # add community grouping names
  tab_spanner(label = "P", columns = 3:6) %>%
  tab_spanner(label = "CAS", columns = 7:9) %>%
  tab_spanner(label = "CBF", columns = 10:12) %>%
  tab_spanner(label = "CBF*", columns = 13) %>%  
  tab_spanner(label = "SGBF (Lower)", columns = 14:16) %>%
  tab_spanner(label = "SGBF (Upper)", columns = 17:19) %>%
  tab_spanner(label = "RFG", columns = 20:25) %>%
  # change tally colour
  tab_style(style = list(cell_fill(color = "grey90")),
    locations = cells_body(columns = 26)) %>%
  # and acacia/proteacea cell colours
  tab_style(style = list(cell_fill(color = "grey90")),
    locations = cells_body(columns = 2, rows = c(37, 41, 58:63))) %>%
  # add footnotes
  tab_footnote(footnote = "CBF to SGBF transition zone.",
    locations = cells_column_labels(columns = 13)) %>%
  tab_footnote(footnote = "Team F report that although Bangalay was not in the diversity plot, it was immediately adjacent",
    locations = cells_body(columns = 2, rows = 11)) %>%
  tab_footnote(footnote = "Family Proteaceae",
    locations = cells_body(columns = 2, rows = c(37, 41))) %>%
  # change font size
  tab_style(style = cell_text(size = px(12)), locations = cells_column_labels()) %>%
  tab_style(style = cell_text(size = px(10)), locations = cells_body()) %>%
  tab_style(style = cell_text(size = px(11)), locations = cells_column_spanners())

comp_table

```

**P: Paddock/Grassland**

This community is characterised by the absence of overstory and midstory. The ground layer has grasses, sedges and some forbs (see purple block). No other functional groups were reported (i.e. no trees, small trees, shrubs).

**CAS: Casuarina Forest**

This community has a *Casuarina glauca* overstory. It is without any other canopy tree species and is missing most of the shrubs that are common elsewhere (e.g. *Acacia* species). There are also some shrub and forb species found here that were not seen in other sites. Forbs were reported in the ground layer (including *Violoa hederaceae* in all sites). Two vine species occurred here that were not reported in any other sites (*Parsonsia straminae*, *Tylophora barbata*). No *Acacia* were reported, whereas *Acacia* were abundant in the midstory of all other plant communities (except the paddock).

**CBF: Coastal Bangalay Forest**

Defined by the presence of *Eucalyptus botryoides* (Bangalay) in the overstory, alongside *Eucalyptus tereticornis* and *Corymbia maculata*.  Other species found in these sites but not elsewhere include *Rubus parvifolius*, *Pultenaea blakelyi*, and *Notelaea longifolia* in midstory and ground layers.

One site did not fit neatly into any one category, which is to be expected given that plant communities do not usually have sharp boundaries. Site 11 had *Eucalyptus tereticornis* and *Notelaea longifolia*, in common with CBF, and but no *Eucalytpus botryoides* were reported. It shared some canopy species with SBGF, but the understory had relatively few of the species characteristic of the SBGF. We showed this site in a distinct colour in the floristics table, so you could see the transition, but for the rest of the analyses site 11 is included in the category CBF.

**SGBF: Spotted Gum/Blackbutt Forest**

These sites are defined by only two dominant overstory tree species: *Corymbia maculata* (Spotted Gum) and *Eucalyptus pilularis* (Blackbutt) with *Acacia* species always reported to be abundant in the midstory. Some of the mid and ground layer species are shared with the RFG sites. This community is further broken into Lower and Upper based on slope position and elevation.

  **Lower slope SGBF**
  
The lower SGBF sites (7, 13, and 18) are relatively flat and have smaller younger trees than the upper slopes (in part due to the history of logging, where the flat accessible areas were preferentially logged). Although the upper and lower slope sites have similar species composition, they have quite different biometric values. 

  **Upper slope SGBF**
  
The upper SGBF sites (22, 23, 24) are on located on the hill slope, going up in elevation from 22 -> 23 -> 24 (which is located on the knoll). Some of these sites have some species that favour lower nutrient environments, such as the two species in the family Proteaceae (*Banksia spinulosa*, *Persoonia linearis*) and the cycad *Macrozamia communis*.

**RFG: Rainforest Gully**

This community has an emergent overstory of *Corymbia maculata* and *Eucalyptus pilularis* (with the exception of site 15) but it also has a number of shorter overstory and midstory species not common in the other communities. These sites are defined by the occurrence of a diverse set of species known to occur in rain forest elsewhere in the region (*Diospyros australis*, *Tristaniopsis collina*, *Synoum glandulosum*, *Eupomatia laurina*, *Hibbertia dentata*, *Clerodendrum tomentosum*, *Ficus coronata*, *Pittosporum revolutum*, *Callicoma serratifolia*) and two species known to occur around watercourses (*Elaeocarpus reticulatus*, and *Sannantha pluriflora*).

There are also some species reported in RFG sites but not other sites that are not rainforest specialists (e.g. *Indigofera australis*, *Kunzea ambigua*, and *Dodonaea triquetra*). Some of the species characteristic of the rain forest were also reported in the SBGF, but not other communities (e.g. *Tristaniopsis collina*, *Synoum glandulosum*, *Eupomatia laurina*, *Hibbertia dentata*, *Clerodendrum tomentosum*, *Leptospermum polygalifolium*, *Leucopogon juniperinus*, and Ferns). This sharing of species reflects that wet sclerophyll forests (such as SGBF) generally have an overstory of *Eucalyptus* and related trees, and an understory including some rainforest-loving species. 

Plantnet notes on rainforest species distribution (https://plantnet.rbgsyd.nsw.gov.au/):

- *Diospyros australis*:	Widespread in warmer rainforest; north from Batemans Bay
- *Tristaniopsis collina*: Grows along rainforest margins and in moist situations in sclerophyll forest
- *Synoum glandulosum*: Widespread in warmer rainforest
- *Eupomatia laurina*: Widespread in or near warmer rainforest
- *Hibbertia dentata*: Mainly in open forest or on margins of rainforest
- *Clerodendrum tomentosum*: Grows in or on the margins of warmer rainforest
- *Ficus coronata*: Often along creeks, in rainforest and open country
- *Pittosporum revolutum*: Grows in rainforest, wet sclerophyll forest, and in dry sclerophyll forest in the south of the range
- *Callicoma serratifolia*: Grows mainly in rainforest and on its margins
- *Elaeocarpus reticulatus*: Mostly in gullies or along watercourses
- *Sannantha pluriflora*: Most commonly grows in eucalypt forest close to watercourses

## Biometric values

Now that we have our floristic community groupings, let's take a look at the biometric data you collected. We will highlight cells for a few key variables based on their values to make it easier to see what's going on. 

A few notes:

* The Spotted Gum - Blackbutt forest (SGBF) is split into lower and upper (on site elevation) and you will notice they differ in their biometric values.
* Site 14 was not surveyed in 2025
* Sedge, fern and tree cover were collected at some but not all sites, so cannot be directly compared between sites (because not reported does not mean they weren't there). They are included in 'Other' for the overall percent cover ranking.

```{r}
# read in data
biometric_data <- read_excel("data/ENVS2018 kioloa biometric 2025.xlsx") %>%
  # drop team column
  select(-1) %>%
  # drop site 14 which wasn't surveyed in 2025
  filter(!Site == 14) %>%
  # custom sort by community to match floristics table
  mutate(Community = factor(Community, levels = c("P", "CAS", "CBF", "SGBF-L", "SGBF-U", "RFG"))) %>%
  arrange(Community)

# make table in gt
biometric_table <- gt(biometric_data) %>%
  tab_options(data_row.padding = px(1)) %>%
  # change font size
  tab_style(style = cell_text(size = px(12)), locations = cells_column_labels()) %>%
  tab_style(style = cell_text(size = px(10)), locations = cells_body()) %>%
  # add header
  tab_header(title = "Biometric data", 
             subtitle = "ENVS2018 Student data Kioloa 2025") %>%
  # format percentages to display %
  fmt_percent(columns = 3:16, decimals = 1) %>%
  # add data grouping labels
  tab_spanner(label = "Percent cover (transects - all sites)", columns = 3:10) %>%
  tab_spanner(label = "Percent cover (some sites)", columns = 11:13) %>%
  tab_spanner(label = "Tree cover", columns = 14:16) %>%
  tab_spanner(label = "Feature counts", columns = 17:19) %>%
  tab_style(style = cell_text(size = px(14)), # Set font size to 14 pixels
    locations = cells_column_spanners()) %>%
  # add row colours for community type (using a 7 colour viridis scale with 0.5 transparency)
  tab_style(style = list(cell_fill(color = "#44015480")),
    locations = cells_body(rows = 1:4, columns = 1:2)) %>%
  tab_style(style = list(cell_fill(color = "#443A8380")),
    locations = cells_body(rows = 5:7, columns = 1:2)) %>%  
  tab_style(style = list(cell_fill(color = "#31688E80")),
    locations = cells_body(rows = 8:10, columns = 1:2)) %>%
  tab_style(style = list(cell_fill(color = "#21908C80")),
    locations = cells_body(rows = 11, columns = 1:2)) %>%
  tab_style(style = list(cell_fill(color = "#35B77980")),
    locations = cells_body(rows = 12:14, columns = 1:2)) %>%
  tab_style(style = list(cell_fill(color = "#8FD74480")),
    locations = cells_body(rows = 15:17, columns = 1:2)) %>%
  tab_style(style = list(cell_fill(color = "#FDE72580")),
    locations = cells_body(rows = 18:23, columns = 1:2)) %>%
  # colour columns according to values
  # Grass > 40%
   tab_style(cell_fill(color = "#F9E3D6"),
    locations = cells_body(columns = Grass, rows = Grass > .4)) %>%
   tab_style(cell_fill(color = "#F2F2F2"),
    locations = cells_body(columns = Grass, rows = Grass < .4)) %>%
  # Leaf litter > 30%
   tab_style(cell_fill(color = "#F9E3D6"),
    locations = cells_body(columns = Litter, rows = Litter > .3)) %>%
   tab_style(cell_fill(color = "#F2F2F2"),
    locations = cells_body(columns = Litter, rows = Litter < .3)) %>%
  # Sedge > 0% highlight and make NAs lighter
   tab_style(cell_fill(color = "#CBC3E3"),
    locations = cells_body(columns = Sedge, rows = Sedge > 0)) %>%
  tab_style(cell_text(color = "grey"),
    locations = cells_body(columns = Sedge, rows = is.na(Sedge == TRUE))) %>%
  # Fern > 0% highlight and make NAs lighter
   tab_style(cell_fill(color = "#CBC3E3"),
    locations = cells_body(columns = Fern, rows = Fern > 0)) %>%
    tab_style(cell_text(color = "grey"),
    locations = cells_body(columns = Fern, rows = is.na(Fern == TRUE))) %>%
  # Format NA values in Tree and Trees as grey
    tab_style(cell_text(color = "grey"),
    locations = cells_body(columns = Tree, rows = is.na(Tree == TRUE))) %>%
  tab_style(cell_text(color = "grey"),
    locations = cells_body(columns = Trees, rows = is.na(Trees == TRUE))) %>%
  # midstory > 15%
   tab_style(cell_fill(color = "#F9E3D6"),
    locations = cells_body(columns = Midstory, rows = Midstory > .15)) %>%
   tab_style(cell_fill(color = "#F2F2F2"),
    locations = cells_body(columns = Midstory, rows = Midstory < .15)) %>%
  # midstory + over > 60%
   tab_style(cell_fill(color = "#F9E3D6"),
    locations = cells_body(columns = Cover, rows = Cover > .6)) %>%
   tab_style(cell_fill(color = "#F2F2F2"),
    locations = cells_body(columns = Cover, rows = Cover < .6)) %>%
  # CWD length > 100m 
   tab_style(cell_fill(color = "#F9E3D6"),
    locations = cells_body(columns = CWD, rows = CWD > 100)) %>%
   tab_style(cell_fill(color = "#F2F2F2"),
    locations = cells_body(columns = CWD, rows = CWD < 100)) %>%
  # add footnotes for the above
    tab_footnote(footnote = "Highlighted grass cover > 40%",
    locations = cells_column_labels(columns = Grass)) %>%
    tab_footnote(footnote = "Highlighted leaf litter > 30%",
    locations = cells_column_labels(columns = Litter)) %>%
    tab_footnote(footnote = "Highlighted sedge and fern values where collected",
    locations = cells_column_labels(columns = c(Sedge, Fern))) %>%
    tab_footnote(footnote = "Highlighted midstory cover > 15%",
    locations = cells_column_labels(columns = Midstory)) %>%
    tab_footnote(footnote = "Highlighted combined mid and overstory cover > 60%",
    locations = cells_column_labels(columns = Cover)) %>%
  tab_footnote(footnote = "NA values indicate this feature's data were not collected or reported, rather than absent",
    locations = cells_column_labels(columns = Trees)) %>%
    tab_footnote(footnote = "Highlighted coarse woody debris where the total length > 100m",
    locations = cells_column_labels(columns = CWD))

biometric_table

```

## Visualisation

That's given us a good overview of how the biometric features vary by community type. Let's now summarise and visualise the data as boxplots. A boxplot shows the mean (middle line of the box), quartiles (the box and whiskers) and outliers (dots) and are useful for comparing quantitative data among groups. 

Note: we are lumping the CBF transiton site 11 in with CBF for these analyses. 

```{r}
biometric_data2 <- biometric_data %>%
  # clean names
  clean_names() %>%
  # convert percentages to 0-100
  mutate(across(3:16, ~ .x * 100))

# break into ground cover data and convert to long format for graphing
cover <- select(biometric_data2, -c(11:16)) %>%
  pivot_longer(cols = 3:10, names_to = "feature", values_to = "percent") %>%
  mutate(feature = as_factor(feature))

# palette
community_palette <- c("P"            = "#440154FF", 
                       "CAS"          = "#443A83FF",
                       "CBF"          = "#31688EFF",
                       "SGBF-L" = "#35B779FF",
                       "SGBF-U" = "#8FD744FF",
                       "RFG"          = "#FDE725FF")

# create box plot for cover
ggplot(cover) +
  geom_boxplot(aes(community, percent, fill = community)) +
  scale_fill_manual(values = community_palette)+
  facet_wrap(~feature) +
  theme_classic()+
  labs(x = "Community", y = "Cover %")+
  ggplot2::theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())

```

Good. We can see there are generally low values for cryptogam, rock and bare ground, so let's remove those to make the others easier to read. 

```{r}
cover2 <- cover %>% 
  filter(feature %in% c("cover", "forb", "grass", "litter", "shrub"))

# create box plot for cover
ggplot(cover2) +
  geom_boxplot(aes(community, percent, fill = community)) +
  scale_fill_manual(values = community_palette)+
  facet_wrap(~feature) +
  theme_classic()+
  labs(x = "Community", y = "Cover %")+
  ggplot2::theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())

```

Interesting!

Now let's look at the mid and overstory cover, plus the combined mid and overstory (called in the plot 'cover'). The combined mid and overstory metric gives us an indication of how much light will get through to the forest floor (which in turn affects which plants can grow there).

```{r}
# break into tree cover data and convert to long format for graphing
tree <- select(biometric_data2, c(1:2, 14:16)) %>%
  pivot_longer(cols = 3:5, names_to = "feature", values_to = "percent") %>%
  mutate(feature = as_factor(feature))

# create box plot for cover
ggplot(tree) +
  geom_boxplot(aes(community, percent, fill = community)) +
  scale_fill_manual(values = community_palette)+
  facet_wrap(~feature) +
  theme_classic()+
  labs(x = "Community", y = "Cover %")+
  ggplot2::theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())
```

Now let's look at the count biometric data: number of trees, number of mature trees (those that potentially have hollows) and length of logs.

```{r}
# break into cover data and convert to long format for graphing
count <- select(biometric_data2, -c(3:16)) %>%
  pivot_longer(cols = 3:5, names_to = "feature", values_to = "count") %>%
  mutate(feature = as_factor(feature)) %>%
  # rename categories for facet labels
  mutate(feature = case_when(
    feature == "trees" ~ "Trees",
    feature == "hollow" ~ "Hollow bearing trees",
    feature == "cwd" ~ "Coarse woody debris length"))

# create box plot for count
ggplot(count) +
  geom_boxplot(aes(community, count, fill = community)) +
  scale_fill_manual(values = community_palette)+
  facet_wrap(~feature) +
  theme_classic()+
  labs(x = "Community", y = "Count of trees / length of CWD (m)")+
  ggplot2::theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())
```

Great! You can use these graphs in your report. 

## Summary Statistics

And we'll calculate the following summary statistics for all features: mean and standard deviation. You can use these numbers in the report.

```{r}
summary_stats <- biometric_data %>% clean_names() %>%
  pivot_longer(cols = 3:16, names_to = "feature", values_to = "value") %>%
  group_by(community, feature) %>%
  summarise(mean = mean(value),
            sd = sd(value)) %>%
  pivot_wider(names_from = 2, values_from = 3:4) %>%
  sjmisc::rotate_df(cn=TRUE) %>% slice(-1) %>%
  rownames_to_column() %>%
  rename("Stat" = 1) %>%
  separate_wider_delim(Stat, "_", names = c("Stat", "Variable"),
                       too_many = "merge") %>%
  arrange(Variable) %>%
  mutate_at(c(3:8), as.numeric) %>%
  na.omit()

summary_stats_table <- gt(summary_stats) %>%
  tab_options(data_row.padding = px(1)) %>%
  # change font size
  tab_style(style = cell_text(size = px(12)), locations = cells_column_labels()) %>%
  tab_style(style = cell_text(size = px(10)), locations = cells_body()) %>%
  # add header
  tab_header(title = "Biometric data summary statistics", 
             subtitle = "ENVS2018 Student data Kioloa 2025") %>%
  # drop trailing zeros
  fmt_number(drop_trailing_zeros = TRUE) %>%
  # format percentages to display %
  fmt_percent(rows = c(1,3,5,7,9,11,13,15,17,19,21), decimals = 1) %>%
  # add column colours (alpha = 0.3)
  tab_style(style = cell_fill(color = "#4401544D"),
    locations = cells_body(columns = 3)) %>%
  tab_style(style = cell_fill(color = "#443A834D"),
    locations = cells_body(columns = 4)) %>%
  tab_style(style = cell_fill(color = "#31688E4D"),
    locations = cells_body(columns = 5)) %>%  
  tab_style(style = cell_fill(color = "#35B7794D"),
    locations = cells_body(columns = 6)) %>%  
  tab_style(style = cell_fill(color = "#8FD7444D"),
    locations = cells_body(columns = 7)) %>%
  tab_style(style = cell_fill(color = "#FDE7254D"),
    locations = cells_body(columns = 8))

summary_stats_table

```

# Bird surveys

We conducted expert bird surveys at all sites. These data are the best quality wildlife data for your reports and we recommend linking the bird observations to the biometric data. The observer (Sho, Julian or Nathan) recorded all birds seen and heard in a five-minute period in the following distance categories: <25m, 25-50m, 50-100m, >100m and overhead. We also asked you to estimate how many species you could identify during the survey. 

## Site visits

Let's start by visualising and summarising the data to get our heads around it. Usually, we aim to visit each site twice, but due to rain and wet-weather access, sites were surveyed 1, 2 or 3 times. 

```{r}
# read in the data and clean names 
birds_expert <- read_excel("data/ENVS2018 kioloa bird data 2025.xlsx", sheet = 1) %>%
  clean_names() %>%
  # replace NAs with zeros
  replace(is.na(.), 0) %>%
  # sum counts by species for inside (0-50m) and outside (50+m) the site, and total
  rowwise() %>%
  mutate(count_in = sum(x25 + x25_50),
         count_out = sum(x50_100 + x100 + overhead),
         count_total = sum(count_in + count_out)) %>%
  select(!c(8:12)) %>%
  mutate(present_in = ifelse(count_in>0, 1, 0),
         present_out = ifelse(count_out>0, 1, 0),
         present_total = ifelse(count_total>0, 1, 0)) %>%
  # add rainy visit tag
  mutate(date = as_date(date),
         rain = ifelse(date == "2025-09-12", "Rain", "No rain"))

# summarise by site for richness
birds_richness <- birds_expert %>% group_by(site, visit, rain) %>%
  mutate(visit = as.factor(visit)) %>%
  summarise(richness_in = sum(present_in>0),
            richness_out = sum(present_out>0),
            richness_total = sum(present_total>0)) %>%
  arrange(site)

# plot site visits
ggplot(birds_richness)+
  geom_line(aes(factor(site), richness_total)) +
  geom_point(aes(factor(site), richness_total, colour = rain, shape = visit),
             size = 4) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45)) +
  xlab("site")+
  scale_colour_viridis_d(option = "inferno", begin = 0.2, end = 0.7)

# count number of visits
birds_counts <- birds_richness %>% 
  select(c(site, visit, richness_total)) %>%
  pivot_wider(values_from = richness_total, names_from = visit) %>%
  clean_names() %>%
  mutate(visits = rowSums(!is.na(across(c(x1, x2, x3)))))

# remove single visit sites and calcualte richness different between visits
birds_alpha <- birds_counts %>%
  filter(visits >1) %>%
  mutate(min = min(c(x1, x2, x3), na.rm = TRUE),
         max = max(c(x1, x2, x3), na.rm = TRUE),
         diff = max - min)

alpha_diff <- data.frame(mean = mean(birds_alpha$diff),
                        min = min(birds_alpha$diff),
                        max = max(birds_alpha$diff),
                        stdev = sd(birds_alpha$diff))

print(alpha_diff)
```

The difference between visits was on average 6.5 bird species (with a min of 1, a max of 14 and standard deviation of 4.7).

Interestingly, the rainy surveys (orange) did not have reduced richness compared to non-rain surveys.

How about the difference in diversity detected between each visit? I.e. the beta diversity. We can only calculate this for sites that were visited more than once. 

The method here is to determine which species are 'common' to visits (not common species in the sense of rarity, but common in that they were recorded at more than one visit) and which species were only recorded at one visit. Species recorded at one visit and not another contribute to beta diversity.

```{r}
# take species list and determine species common to all lists (alpha) and those different between visits (beta)
birds_beta <- birds_expert %>%
  group_by(site, common_name) %>%
  summarise(visit_count = n_distinct(visit), .groups = "drop") %>%
  group_by(site) %>%
  summarise(
    total_species = n_distinct(common_name),
    common_species = sum(visit_count >= 2),
    beta = total_species - common_species,
    .groups = "drop"
  ) %>%
  # remove sites with a single visit
  left_join(select(birds_counts, c(site, visits))) %>%
  filter(visits > 1)

beta_diff <- birds_beta %>%
  summarise(
    mean = mean(beta),
    min = min(beta),
    max = max(beta),
    stdev = sd(beta)
  )

differences <- bind_rows(alpha_diff, beta_diff) %>%
  add_column(type = c("alpha", "beta"), .before = "mean")

print(differences)
```

The difference in species diversity recorded between visits (the beta diversity) was double the difference in species richness (the alpha diversity). There was always differences in the diversity between visits (the minimum was 7) and the mean beta diversity was 12. 

This is part of why we do repeat visits to site- to capture the diversity. Visits may differ by time of day (e.g. 6am or 7am) or weather. 

## Species richness

From here on we will use the total richness detected (i.e. total number of unique species across all visits).

Let's summarise the species richness by sites. We will just do this for birds 'in' the site (i.e. within 50m, since then we can compare these data with the vegetation). Let's colour these by floristic community. 

```{r}
# filter to birds within 50m
birds_insite <- birds_expert %>% 
  filter(present_in>0) %>%
  group_by(site) %>%
  summarise(richness = length(unique(common_name)))

# format for use in the package 'vegan'
birds_vegan <- birds_expert %>%
  arrange(site) %>%
  select(c(site, common_name, count_in)) %>%
  pivot_wider(names_from = common_name, values_from = count_in, values_fn = sum, values_fill = 0) %>%
  column_to_rownames(var = "site")

# create table of sites and communities
communities <- data.frame(site = c(8, 9, 10, 12,
                                   1, 2, 4,
                                   3, 5, 6, 11,
                                   7, 13, 18, 14,
                                   22, 23, 24,
                                   15, 16, 17, 19, 20, 21),
                          community = c(rep("P", 4),
                                        rep("CAS", 3),
                                        rep("CBF", 4),
                                        rep("SGBF-L", 4),
                                        rep("SGBF-U", 3),
                                        rep("RFG", 6))) %>%
  mutate(community = as_factor(community))

# assign communities to bird data
birds_insite2 <- left_join(communities, birds_insite) %>%
  mutate(community = as_factor(community)) %>%
  arrange(community)

# set the plots in the right order for plotting
birds_insite2$site <- factor(birds_insite2$site, levels = birds_insite2$site)

# plot by community
ggplot(birds_insite2) +
  geom_boxplot(aes(community, richness, fill = community))+
  scale_fill_viridis_d()+
  theme_minimal() +
  theme(axis.text.x = element_blank())

# summary statistics
birds_summary <- birds_insite2 %>% group_by(community) %>%
  summarise(mean_richness = mean(richness),
            stdev = sd(richness))

print(birds_summary)

# test if there is a difference in richness by community
m1 <- aov(richness ~ community,
         data = birds_insite2)
summary (m1)

TukeyHSD(m1)

par(mar = c(5, 8, 4, 2))
plot(TukeyHSD(m1), las = 2, cex.axis=0.75)
```

Interesting! The upper slope forest had the highest species richness, with an average of 13 species. The paddock (unsuprisingly) had the lowest. What is really interesting is that usually (in 2022-2024; mean 14 species in 2024) the rainforest has the highest bird species richness. Two reasons we have theorised for this:

1) The rainforest sites were only surveyed once in 2025, which (as we know from the above section on beta diversity) will artificially deflate their overall richness compared to the sites that were visited multiple times. That means, with additional visits, the rainforest diversity may have been higher (this also applies to the coastal sites).
2) Rainforest plant species are increasingly found in the SGBF (see note in the vegetation community descriptions), and so 'rainforest' type birds (not necessarily specialists but ones usually associated with the rainforest gullies, such as brown cuckoo-dove) are being detected in the SGBF.

There was a significant difference in richness between the community types (p = 0.0255). Note: this is only testing the difference in the number of species, not the difference in their diversity. But this difference was driven by the difference in richness between the Upper slope forest and the paddock (only pairing that crosses zero in the Tukey test).

**Please note**, you do not have to use the statistical analyses in your report unless you feel confident doing so. If not, stick to the summary data and interpretation of the tables and figures. 

## Beta diversity

But as we know, richness doesn't tell us everything. What about beta diversity between the sites and communities?

```{r}
# select all birds in sites
species <- birds_expert %>%
  filter(present_in==1) %>%
  # add community
  left_join(communities)

# for loop of birds only found in that site
sites_beta <- data.frame()
sites <- unique(birds_expert$site)

for (i in 1:24) {
site_test <- species %>% filter(site == sites[i])
site_other <- species %>% filter(!site == sites[i])

diff_site <- setdiff(site_test$common_name, site_other$common_name)

if(length(diff_site) == 0){ 
  next 
  }
out <- data.frame(site = sites[i], unique = diff_site)
sites_beta <- rbind(sites_beta, out)
}

print(sites_beta)

```

Cool. Nearly half of the sites had at least one unique bird species found no where else. Some sites had multiple unique species:

* Site 9: welcome swallow, common starling, brown songlark (a species recorded for the first time this year) and australasian pipit. These are classic grassland species, typical of the paddock.
* Site 10: magpie lark, wood duck, chestnut teal (another duck), and pacific black duck. It must have been a real pond out there! Quack quack.
* Site 14: black-faced cuckooshrike and brown cuckoo-dove. The latter is a frugivore so perhaps a plant was fruiting in the plot - maybe native cherry *Exocarpos cupressiformis*
* Site 23: fan-tailed cuckoo and red-browed treecreeper. We heard the cuckoo throughout, but mostly on the upper slopes, and the red-browed treecreeper is a specialist of big old trees with decorticating bark. 

Let's now look at the unique diversity across the floristic communities. 

```{r}
# for loop of birds only found in that community
comm_beta <- data.frame()
comm <- as.character(unique(communities$community))

for (i in 1:6) {
comm_test <- species %>% filter(community == comm[i])
comm_other <- species %>% filter(!community == comm[i])

diff_comm <- setdiff(comm_test$common_name, comm_other$common_name)

if(length(diff_comm) == 0){ 
  next 
  }
out <- data.frame(community = comm[i], unique = diff_comm)
comm_beta <- rbind(comm_beta, out)
}

# summarise unique birds
comm_beta_sum <- comm_beta %>% 
  mutate(community = as_factor(community)) %>%
  group_by(community) %>% 
  summarise(unique_species = length(unique)) %>%
  # add zero value for CBF
  rbind(data.frame(community = "CBF", unique_species = 0)) %>%
# custom sort by community to match floristics table
  mutate(community = factor(community, levels = c("P", "CAS", "CBF", "SGBF-L", "SGBF-U", "RFG"))) %>%
  arrange(community)

# plot unique birds by community
ggplot(comm_beta_sum, aes(community, unique_species))+
  geom_bar(aes(fill = community), stat = "identity")+
  geom_text(aes(label = unique_species), vjust=1.6, color="white", size = 4)+
  scale_fill_viridis_d()+
  theme_minimal()

# print the unique birds
print(comm_beta)

```

Very cool! There were a total of 21 bird species only found in one community type. The paddock had the greatest number of unique species (n=11). 

We only detected Mistletoebird in the upper slope eucalypt forest. As the name suggests, Mistletoebirds specalise on mistletoe fruit. Mistletoes are hemiparasitic plants that grow on the branches of other plants. There are approximately 100 species of mistletoe in Australia and these often have only one or two host trees. Mistletoes are an important element of eucalypt forests and woodlands because they provide fruit (for frugivorous birds) and, more importantly, they provide pockets of cover that are good for nesting in. Of the Australian birds that construct nests in trees, roughly two-thirds of them will preferentially nest in mistletoe. Mistletoe can have a bad reputation in popular culture because of the misconception that they kill trees. In some cases, mistletoe loads become high and this places additional water stress on the host tree; but the underlying cause of this issue is habitat fragmentation. It is possible that we detected Mistletoebird in site 19 because of the presence of Mistletoe. Interestingly, this happened in 2023 and 2024 too - where mistletoebird was only detected in site 13. 

Despite the apparent 'lack' of 'habitat' in the paddocks, there are a number of birds that are found in the paddock and nowhere else. Different birds have different requirements, some of which include open grassland areas and some are resilient to degraded landscapes. For example, the Australasian Pipit is a grassland insectivore that is mostly usually on the ground in open pasture or native grassland. It nests on the ground in tussocks. 

These are just a couple of examples of how unique species relate to the vegetation and landscape. You could look into more of the unique species' ecology for your report.

## Diversity indices

We can also calculate indices for diversity aside from richness. For instance, Simpsons's diversity index takes into account abundance as well as richness. Why do we care about abundance? Some species are not evenly distributed in the landscape, even if they are found in more than one place. This metric helps us take that into account.

```{r}
# calculate simpson's diversity index for each site
communities <- communities %>%
  mutate(site = as.character(site))

simpson <- as.data.frame(diversity(birds_vegan, index = "simpson")) %>%
  rownames_to_column() %>%
  rename(site = 1,
         simpsons = 2) %>%
  left_join(communities)

# plot simpsons by community
ggplot(simpson) +
  geom_boxplot(aes(community, simpsons, fill = community))+
  scale_fill_viridis_d()+
  theme_minimal() +
  theme(axis.text.x = element_blank())+
  ylim(c(0.55, 1))

# test difference
simpson2 <- diversity(birds_vegan, index = "simpson")

simpson_aov <- aov(simpson2 ~ community, data = communities)
anova(simpson_aov)

```

Note the y-axis is limited to a minimum of 0.55 to make this easier to read. 

The upper slope forest had the highest average Simpson's diversity index, which means it is more biodiverse in terms of both species richness and abundance. The paddock had the lowest average Simpson's diversity index (but was higher than previous years due to the presence of duck diveristy - thanks to the rain).

There was no significant difference in Simpson's diversity index among the communities.  

## Bird communities

**(This section is interesting but you don't have to include it in your report)**

So far we have looked at the bird richness by the floristic communities. But what about the bird communities? That is, which species tend to be together due to shared habitat features they prefer (or avoid). 

We'll use a constrained ordination to determine bird communities. An ordination examines communities across space and a contrained ordination examines communities across specific environmental variables (in our case, biometric data). The type we are doing is called 'Canonical Correspondence Analysis' (CCA). 

For more information on how this works you can use the same tutorial I did to produce this: https://rpubs.com/an-bui/vegan-cheat-sheet

```{r}
# exclude site 14 because biometrics not done this year and exclude paddocks
birds_vegan2 <- birds_vegan %>%
  slice(-14)

# format biometric so rownames are site numbers 
biometric_data3 <- biometric_data2 %>%
  arrange(site) %>%
  column_to_rownames(var = "site")

# CCA - note can't use any variables with NAs in the data (so excluded cwd)
birdCCA <- cca(birds_vegan2 ~ grass + shrub + forb + litter + rock + 
                 bare + midstory + overstory + hollow , data = biometric_data3)

# extracting the bird community data
CCA_bird <- as.data.frame(birdCCA$CCA$v) %>%
  rownames_to_column()%>%
  rename(bird = rowname)

# plot
ggplot() +
  geom_point(data = CCA_bird, aes(x = CCA1, y = CCA2), color = "darkblue")+
  geom_text_repel(data = CCA_bird, aes(x = CCA1, y = CCA2, label = bird),
                  nudge_y = 0.05, max.overlaps = Inf, size = 2.5) +
  theme_minimal()+
  scale_x_continuous(limits = c(-4, 6))+
  scale_y_continuous(limits = c(-3, 5))

```

Awesome! Let's read this figure. You can essentially ignore the axes here (arbitrary numbers in ordination space). What we are interested in is the grouping of birds. What this figure shows us is how birds cluster in the landscape according to the vegetation features (at least the ones we measured). The lines are labels for birds that are really clustered - follow the line to see the position of the dot (apologies the font is a little small to fit it all on the graph). And it looks pretty good! 

The cluster of Pacific black duck, wood duck, chestnut teal and magpie lark were found at paddock site 9. Likewise, the cluster of pipit, brown songlark, starling and welcome swallow were found at paddock site 10. These paddock clusters have different biometric features (and therefore are separate in ordination space) because 9 had lots of mud (22% cover bare ground in the tally) while site 10 had not much (only 8% mud). This makes sense for the ducks! And likewise, magpie larks are mud nest builders, so perhaps they were visiting site 9 to get mud. Masked lapwing and willie wagtail are located between these clusters because they were found at both paddock sites. 

The cluster of yellow thornbill and satin bowerbird were species found in the Casuarina forest - which is far away from the other clusters in ordination space because of how different the casuarina forest is in terms of vegetation structure. Yellow thornbill is the closest thing we have to a casuarina 'specialist'.

The major cluster in the middle are the forest birds. We can see some patterns in these forest bird clusters:

* Red-browed treecreeper, white-throated treecreeper and varied sitella all have the same foraging style of 'creeping' along horizontal canopy branches of big old trees with decorticating bark to look for insects. These were clustered together!
* Eastern yellow robin, golden whistler, brown gerygone and striated thornbill were found at nearly all of our forest sites, which is why they're in the middle of the ordination. 
* Several honeyeater species were found at similar sites: new holland, yellow-faced and eastern spinebill. Whereas lewin's honeyeater are found further out because one was recorded at paddock site 12 (out in the open on the edge of the creek), little wattlebird were found at the coast (and community garden, but generally a coastal specialist) and white-naped honeyeater are clustered with the old growth specialists.

It is very interesting that the two fairywren species are distributed differently in ordination space - this indicates we found them in different vegetation. We saw superb fairywren in both forest and the paddocks, whereas we only saw varigated fairywrens in the forest - indicating one is more generalist and the other more specialist. 

## Student estimates of bird richness

**(This section is interesting but you don't have to include it in your report)**

And out of interest, how well did you do at estimating the bird richness at each site? Let's compare average expert and student counts. These are total (i.e. all within 50m and >50m). 

```{r}
# read in data
birds_student <- read_excel("data/ENVS2018 kioloa bird data 2025.xlsx", sheet = 2) %>%
  clean_names() %>%
  select(c(site, estimate)) %>%
  rename(count = estimate) %>%
  mutate(type = "student")

# combine expert and student
birds_compare <- birds_richness %>% 
  ungroup() %>%
  select(c(site, richness_total)) %>%
  rename(count = richness_total) %>%
  mutate(type = "expert") %>%
  rbind(birds_student) %>%
  # remove rows with only single estimate
  filter(!site %in% c(1:11, 21:24))
  
# plot expert and student
ggplot(birds_compare)+
  geom_boxplot(aes(type, count, fill = type), alpha = .8) +
  theme_minimal()+
  theme(axis.text.x = element_text(angle=45))+
  facet_wrap(~site)
```

Note: the expert counts look like a line when they were only surveyed by one expert (and therefore there is no variation in the count).

In general, you underestimated the total number of species- which is to be expected! It takes a lot of practice and patience to learn bird calls. I hope you enjoyed coming out on the bird surveys with us and I appreciated your enthusiasm and quick learning. 

## Acoustic data

**(This section is interesting but you don't have to include it in your report)**

You also surveyed the sites using acoustic meters. We collected data for two hours around dusk and dawn for one night. One of the benefits of acoustic meters is they can help sample diversity that otherwise would be missed in the time constraints of a five-minute count. The other benefit was to teach you how to use this kit and read sonograms! Let's see what we detected. We'll start with species richness by site.

```{r}
# read in 
acoustic <- read_excel("data/ENVS2018 kioloa acoustic data 2025.xlsx", sheet = 1) %>%
  clean_names() %>%
  mutate(site = as.character(site))

acoustic_rich <- acoustic %>% group_by(site) %>%
  summarise(richness = length(unique(common_name))) %>%
  left_join(communities) %>%
  mutate(type = "acoustic")

# plot by site
ggplot(acoustic_rich)+
  geom_boxplot(aes(community, richness, fill = community))+
  scale_fill_viridis_d()+
  theme_minimal()
```

The paddock had relatively high species richness because you can hear much further in these sites (no pesky trees blocking the sound). This is one of the drawbacks of the acoustic meters compared to the expert surveys: it's easier in the 5 minute counts to delineate birds as in or out of the site (and therefore linkable to biometric data). 

For example, the masked lapwings heard on the acoustic meter might have been further away than 50m because their call carries. We could have tested this by playing a known volume tone at 50m from the meters to figure out how 'loud' something needs to be to be in the site.

How did the richness detected on the acoustic meters compare with the bird surveys?

```{r}
# combine acoustic and expert bird counts
acoustic_compare <- birds_insite2 %>%
  mutate(type = "expert") %>%
  full_join(acoustic_rich)

# plot comparison
ggplot(acoustic_compare) +
  geom_boxplot(aes(type, richness, fill = community))+
  scale_fill_viridis_d()+
  facet_wrap(~community)+
  theme_minimal()

# test difference
aco <- aov(richness ~ type, data = acoustic_compare)
anova(aco)

```

We detected more species on the acoustic meters in the paddock and rainforest. There was no effect of sampling type on species richness (i.e. no significant difference between the methods for determining species richness).

A caveat here is that we simply used 'loudness' of the acoustic data as a proxy for distance, so the two aren't directly comparable. 

You can imagine the addition of time to a bird survey as a curve of diminishing returns- you add more time, you get more species, but at a decaying rate of increase over time. So we could achieve higher richness counts by doing say, a 15-minute or even 1-hour bird survey (imagine that!), but that would not be a good use of people-time. This is where acoustic meters can come in handy. 

Another important use of acoustic meters is to detect rare things that don't call often. If you were tasked with finding a Night Parrot, you would have to spend 1000s of hours in the remote spinifex desert to potentially hear a short call; which is why agencies like Parks and NGOs such as AWC instead deploy acoustic meters and then use AI to scan through in search of the target species. 

However we've only looked at species richness. How about the beta diversity between the acoustic and expert counts? That is, how many species are only found using each method?

```{r}
# for loop of birds only found in that community
aco_beta <- data.frame()
species2 <- species %>% filter(present_in==1)

for (i in 1:24) {
uni_exp <- species2 %>% filter(site == sites[i])
uni_aco <- acoustic %>% filter(site == sites[i])

diff1 <- setdiff(uni_exp$common_name, uni_aco$common_name) %>%
  as.data.frame() %>%
  rename(unique = 1) %>%
  mutate(source = "expert",
         site = sites[i])
diff2 <- setdiff(uni_aco$common_name, uni_exp$common_name)%>%
  as.data.frame() %>%
  rename(unique = 1) %>%
  mutate(source = "acoustic",
         site = sites[i])

aco_beta <- rbind(aco_beta, diff1, diff2)
}

aco_beta2 <- aco_beta %>%
  mutate(site = as.character(site)) %>%
  group_by(site, source) %>%
  summarise(beta = length(unique(unique))) %>%
  left_join(communities)

# plot difference
ggplot(aco_beta2)+
  geom_boxplot(aes(source, beta, fill=community))+
  scale_fill_viridis_d()+
  facet_wrap(~community)+
  theme_minimal()

# test difference
aco_b <- aov(beta ~ source, data = aco_beta2)
anova(aco_b)

```

Again, more species were found by the acoustic meters in the paddock and rainforest that were not detected during the expert surveys.

There was no significant difference between the survey methods in the number of unique species detected.

Aside from the study sites, were there any unique species found only on the expert counts or acoustic meters across the whole campus?

```{r}
b_exp <- setdiff(species2$common_name, acoustic$common_name) %>%
  as.data.frame() %>%
  rename(unique = 1) %>%
  mutate(source = "expert")

b_aco <- setdiff(acoustic$common_name, species2$common_name)%>%
  as.data.frame() %>%
  rename(unique = 1) %>%
  mutate(source = "acoustic")

aco_beta3 <- rbind(b_exp, b_aco)

print(aco_beta3)
  
```

Cool! Some of these species were detected during the bird surveys but not within the site itself (i.e. heard at a distance instead of within 50m). For example, we heard yellow-tailed black cockatoo and jacky winter during the expert counts but not in the sites. This may be an indication that the acoustic meters are hearing "too far".

We also picked up 4 frog species on the acoustic meter and one nocturnal bird (southern boobook, an owl). Only the expert surveys picked up some tricky to discern calls, such as red-browed treecreeper, or non-calling species like most of the ducks (except pacific black duck that one group found on the meters).

What about out of the sites? Let's sum up the total richness of birds recorded across the whole campus from both methods

```{r}
# all bird species 
species_expert <- data.frame(species = unique(birds_expert$common_name),
                             type = "expert")
species_acoustic <- data.frame(species = unique(acoustic$common_name),
                             type = "acoustic")

species_all <- rbind(species_expert, species_acoustic) %>%
  mutate(type = ifelse(duplicated2(species, bothWays=TRUE)==TRUE,"both",type)) %>%
  #remove the non birds
  filter(!species %in% c("Common Eastern Froglet", "Blue Mountains Tree Frog",
         "Spotted Grass Frog", "Cow", "Southern Green Stream Frog")) %>%
  distinct()

# make gt table
species_all %>% 
  group_by(type) %>% 
  gt() %>%
  tab_options(data_row.padding = px(1)) %>%
  # change font size
  tab_style(style = cell_text(size = px(12)), locations = cells_column_labels()) %>%
  tab_style(style = cell_text(size = px(10)), locations = cells_body())
  
species_all_summary <- species_all %>%
  group_by(type) %>%
  summarise(count = length(species))

species_all_summary

```

We detected a total of 64 bird species. Of these, 41 were detected on both the acoustic meters and in the bird surveys, where 22 were only detected on the expert counts and 1 in the acoustics (the boobook). 

# Other wildlife results

**(This section is interesting but you don't have to include it in your report)**

You don't have to report on this section, but we wanted to show you some interesting findings. 

## Cameras

Let's have a look at how our camera results compared with previous years. 

```{r}
# groups
mammals <- c("Eastern Grey Kangaroo", "Swamp Wallaby", "Red-necked Wallaby", 
             "Short-beaked Echidna", "Common Wombat",
             "Brush-tailed Possum", "Krefft's Glider", 
             "Black Rat", "Bush Rat", "Rat sp", "Swamp Rat", "House Mouse",
             "Long-nosed Bandicoot", "White-footed Dunnart", "Brown Antechinus",
             "Cat", "Red Fox", "Pig" , "Sheep", "Cow")

# read in data
camera <- read_excel("data/ENVS2018 kioloa data 2017-2025.xlsx", sheet = 2) %>%
  clean_names() %>%
  distinct() %>%
  #remove skinks
  filter(!common_name == "Delicate Sun-skink") %>%
  mutate(taxa = ifelse(common_name %in% mammals, "mammal", "bird")) %>%
  filter(taxa == "mammal") %>%
  mutate(common_name = factor(common_name, levels = mammals))

# plot mammals
ggplot(camera)+
  geom_point(aes(year, common_name, colour = common_name), size = 4)+
  scale_colour_viridis_d()+
  theme_minimal()+
  theme(legend.position= "none")+
  theme(axis.title.y=element_blank())+
  scale_y_discrete(limits=rev)+
  scale_x_continuous(n.breaks = 7)+
  coord_fixed(ratio = 0.6)

```

Here we can see which species were seen in which years. The occurrence of these species might relate to environmental conditions (e.g. drought). Note: the cameras were not placed in rainforest and coastal locations in 2017-2020, only upper and lower slope eucalypt forest and paddock. Also note there was a bushfire in the 2019/2020 Summer. No data was collected in 2021 (covid-19). 

## Herpetofauna

Let's do the same thing with the reptiles and frogs (from tin/tile and opportunistic records).

```{r}
# read in data
herpsp <- c("Eastern Small-eyed Snake", "Red-bellied Black Snake", "Diamond Python",
            "Jacky Dragon", "Blue-tongued Lizard", "Delicate Sun-skink", 
            "Weasel Skink", "Skink sp", "Lace Monitor",
            "Whistling Tree Frog", "Jervis Bay Tree Frog",
            "Peron's Tree Frog", "Blue Mountains Tree Frog", 
            "Eastern Dwarf Tree Frog", "Southern Green Stream Frog",
            "Screaming Tree Frog", "Striped Marsh Frog", "Spotted Marsh Frog",
            "Tyler's Toadlet", "Common Eastern Froglet", "Haswell's Froglet")

herps <- read_excel("data/ENVS2018 kioloa data 2017-2025.xlsx", sheet = 1) %>%
  clean_names() %>%
  select(2:3) %>%
  # remove mice
  filter(!common_name == "House Mouse") %>%
  distinct() %>%
  mutate(common_name = factor(common_name, levels = herpsp))

# plot
ggplot(herps)+ 
  geom_point(aes(year, common_name, colour = common_name), size = 4)+
  scale_colour_viridis_d()+
  theme_minimal()+
  theme(legend.position= "none")+
  theme(axis.title.y=element_blank())+
  scale_y_discrete(limits=rev)+
  scale_x_continuous(n.breaks = 7)+
  coord_fixed(ratio = 0.6)

```

This is really an indication of the survey effort for herpetofauna! In 2018-2020 we only had tin/tile (AKA substrate) checks (which were done by students instead of expert observers) whereas in 2022 we started recording incidental sightings and doing the pond frog surveys. 

We recorded one new species for ENVS2018 in 2024: spotted grass frog (*Limnodynastes tasmaniensis*). 

I wonder how these results compare with the frog diversity in the pre-readings?

## Birds over time

Lastly, let's look at how the bird diversity has changed over the years (remember you do not need to include this in your report). 

Note: the casuarina forest and rainforest sites were added in 2022. 

```{r}
# read in name changes
site_names <- read_excel("data/KCC new and old gps.xlsx") %>%
  select(1:2) %>%
  rename(old_name = 1,
         new_name = 2)

# vector of old site names
old <- unique(site_names$old_name)

# vector of new site names
new <- 1:24

# read in bird data since 2017
birds_years <- read_excel("data/ENVS2018 kioloa data 2017-2025.xlsx", sheet = 4) %>%
  clean_names() %>%
  rename(old_name = site) %>%
  left_join(site_names) %>%
  # rename sites to be consistent with new names
  mutate(site = ifelse(old_name %in% old, new_name, old_name)) %>%
  # remove birds outside of survey points
  filter(radius == "0-50") %>%
  select(c(site, year, species)) %>%
  # filter to remove sites no longer surveyed
  filter(site %in% new)

# summarise by year and site
birds_year_sum <- birds_years %>% group_by(year, site) %>%
  summarise(count = length(unique(species))) %>%
  mutate(year = as.factor(year),
         site = as.factor(site)) %>%
  arrange(site)

# plot by year
ggplot(birds_year_sum)+
  geom_boxplot(aes(year, count, group=year, fill = year))+
  scale_fill_viridis_d()+
  theme_minimal()

```

And over the years between sites.

```{r}
# plot by site
ggplot(birds_year_sum)+
  geom_point(aes(year, count, colour = site))+
  geom_line(aes(year, count, group = site, colour = site))+
  scale_colour_viridis_d()+
  theme_minimal()
```

And lastly, some summary data

```{r}
#summary
birds_year_sum %>%
  group_by(year) %>%
  summarise(mean = mean(count),
            max = max(count),
            min = min(count),
            sd = sd(count)) %>% 
  gt() %>%
  tab_style(style = cell_text(size = px(12)), locations = cells_body())
```

I hope you enjoyed reading this data summary. Good luck with the report writing!

# Session information

```{r}
# Display version information for R, OS, and packages
sessionInfo()
```